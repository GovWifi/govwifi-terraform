name: govwifi-terraform-linting
on: [push, pull_request]
jobs:
  test:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v2

      # - name: lint
      #   run: |
      #     brew install tfenv tflint grep findutils
      #     tfenv install $(cat .terraform-version)
      #     tfenv use $(cat .terraform-version)
      #     GITHUB_TOKEN=${{ secrets.GH_TOKEN }} tflint --init
      #     PATH="/usr/local/opt/findutils/libexec/gnubin:$PATH" make lint
  validate:
    runs-on: ubuntu-20.04
    steps:
      - uses: actions/checkout@v2

      - name: validate
        run: |
          brew install tfenv
          tfenv install $(cat .terraform-version)
          tfenv use $(cat .terraform-version)
          for dir in govwifi/*;
          do
            cd $dir
            terraform init -backend=false
            echo "Validating $dir"
            terraform validate
            cd -
          done
